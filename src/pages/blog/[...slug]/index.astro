---
import { cn } from '~/libs/utils';
import Layout from '~/layouts/layout.astro';
import type { CollectionEntry } from 'astro:content';
import { getCollection, render } from 'astro:content';
import Giscus from '~/components/main/giscus.astro';
import PageHead from '~/components/main/page-head.astro';
import TOCHeader from '~/components/article/toc-header.astro';
import TOCSidebar from '~/components/article/toc-sidebar.astro';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((post) => ({
		params: { slug: post.id },
		props: post
	}));
}

type Props = CollectionEntry<'blog'>;

const post = Astro.props;
const { Content, headings } = await render(post);
---

<Layout className="flex w-full flex-col space-y-12">
	<PageHead slot="head" title={post.data.title} description={post.data.description || undefined} />
	<TOCHeader slot="table-of-contents" headings={headings} />

	<div class="relative flex flex-row gap-6">
		<article class={cn('space-y-4 xl:space-y-8 z-40 rounded-sm flex-1')}>
			<header class="mb-4 flex justify-between lg:mb-6">
				<h1 class="text-4xl font-semibold">
					{post.data.title}
				</h1>
			</header>

			<Content />
		</article>
		<TOCSidebar headings={headings} />
	</div>

	<Giscus />
</Layout>
