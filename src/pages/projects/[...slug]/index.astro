---
import { cn } from '~/libs/utils';
import Sidebar from '~/components/projects/sidebar.astro';
import { Badge } from '~/components/shared/badge';
import Layout from '~/layouts/layout.astro';
import type { CollectionEntry } from 'astro:content';
import { getCollection, render } from 'astro:content';
import { Eye, Github } from 'lucide-react';

export async function getStaticPaths() {
	const posts = await getCollection('projects');
	return posts.map((post) => ({
		params: { slug: post.id },
		props: post
	}));
}

type Props = CollectionEntry<'projects'>;

const post = Astro.props;
const { Content } = await render(post);
---

<Layout title={post.data.title} class="lg:max-w-4xl">
	<main>
		<div class="mx-auto flex justify-center gap-12 px-4">
			<article class={cn('space-y-4 xl:space-y-8 z-40 w-full rounded-sm')}>
				<header class="mb-4 flex justify-between lg:mb-6">
					<div class="text-2xl leading-tight font-extrabold text-gray-900 dark:text-white">
						{post.data.title}
					</div>
					{
						(post.data.site || post.data.repository) && (
							<div class="block flex items-center gap-2 font-sans text-base xl:hidden">
								{post.data.repository && (
									<a
										href={post.data.repository}
										class="text-primary flex items-center gap-2"
										target="_blank"
										rel="noreferrer"
									>
										<Github size={18} />
										<span class="text-sm hover:underline">Source code</span>
									</a>
								)}

								{post.data.site && post.data.repository && (
									<div class="mx-1 h-4 w-px bg-neutral-800" />
								)}

								{post.data.site && (
									<a
										href={post.data.site}
										class="text-primary flex items-center gap-2"
										target="_blank"
										rel="noreferrer"
									>
										<Eye size={18} />
										<span class="text-sm hover:underline">Site</span>
									</a>
								)}
							</div>
						)
					}
				</header>
				<div class="block flex flex-wrap gap-2 xl:hidden">
					{
						post.data.tools.map((tool: any) => (
							<Badge className="px-1 py-0 text-sm" variant="secondary">
								{tool}
							</Badge>
						))
					}
				</div>

				<Content />
			</article>

			<aside class="hidden xl:block xl:w-[350px]">
				<Sidebar
					tools={post.data.tools}
					site={post.data.site}
					repository={post.data.repository}
					class="sticky top-10"
				/>
			</aside>
		</div>
	</main>
</Layout>
