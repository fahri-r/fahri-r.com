---
import Layout from '~/layouts/layout.astro';
import ProjectCard from '~/components/projects/project-card.astro';
import { getCollection } from 'astro:content';
import type { PaginateFunction } from 'astro';
import { SITE } from '~/constants/global';
import { PaginationComponent } from '~/components/shared/pagination';

const TITLE = 'Projects';
const DESCRIPTION = 'Several projects that I have worked on, both private and open source.';

export async function getStaticPaths({ paginate }: { paginate: PaginateFunction }) {
	const projects = (await getCollection('projects')).sort((postA, postB) => {
		const aDate = new Date(postA.data.date);
		const bDate = new Date(postB.data.date);
		return bDate.getTime() - aDate.getTime();
	});

	return paginate(projects, { pageSize: SITE.pageSize });
}

const { page } = Astro.props;
---

<Layout title={TITLE} description={DESCRIPTION}>
	<main class="">
		<h1 class="font-sans text-xl font-bold">{TITLE}</h1>
		<p class="text-muted-foreground mb-4 text-sm leading-relaxed">
			{DESCRIPTION}
		</p>

		<div class="mx-auto mb-4 grid max-w-[800px] grid-cols-1 gap-3 sm:grid-cols-2">
			{page.data.map(async (project) => <ProjectCard entry={project} />)}
		</div>

		<PaginationComponent
			client:load
			currentPage={page.currentPage}
			totalPages={page.lastPage}
			baseUrl={'/projects/'}
		/>
	</main>
</Layout>
