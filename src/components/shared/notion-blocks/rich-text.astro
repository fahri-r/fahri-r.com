---
import katex from 'katex';
import type { RichText } from '~/interfaces/notion/block.interface';
import Bold from './annotations/bold.astro';
import Italic from './annotations/italic.astro';
import Strikethrough from './annotations/strikethrough.astro';
import Underline from './annotations/underline.astro';
import Color from './annotations/color.astro';
import Code from './annotations/code.astro';
import Anchor from './annotations/anchor.astro';
import Mention from './mention.astro';

interface Props {
	richText: RichText;
}

const { richText }: Props = Astro.props;
---

<Anchor richText={richText}>
	{
		(
			<Code richText={richText}>
				{
					<Color richText={richText}>
						{
							<Underline richText={richText}>
								{
									<Strikethrough richText={richText}>
										{
											<Italic richText={richText}>
												{
													<Bold richText={richText}>
														{richText.text?.content &&
															richText.text.content.split('\n').map((content, i) => (
																<>
																	{i > 0 && <br />}
																	{content}
																</>
															))}

														{richText.equation && (
															<span
																set:html={katex.renderToString(richText.equation.expression, {
																	throwOnError: false
																})}
															/>
														)}
														{richText.mention && richText.mention.page && (
															<Mention pageId={richText.mention.page.id} />
														)}
													</Bold>
												}
											</Italic>
										}
									</Strikethrough>
								}
							</Underline>
						}
					</Color>
				}
			</Code>
		)
	}
</Anchor>
